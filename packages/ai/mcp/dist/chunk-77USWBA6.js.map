{"version":3,"sources":["../src/registry.ts"],"names":[],"mappings":"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","file":"chunk-77USWBA6.js","sourcesContent":["import type { MCPTool, AgentType } from \"@repo/shared\";\r\nimport { MCPServerWrapper } from \"./server\";\r\nimport { MCPClient, type TransportConfig } from \"./client\";\r\n\r\ninterface RegisteredServer {\r\n    wrapper?: MCPServerWrapper;\r\n    client?: MCPClient;\r\n    isRemote: boolean;\r\n}\r\n\r\nexport class MCPRegistry {\r\n    private static instance: MCPRegistry;\r\n    private servers: Map<string, RegisteredServer> = new Map();\r\n    private agentToolMappings: Map<AgentType, string[]> = new Map();\r\n\r\n    private constructor() {\r\n        this.initializeDefaultMappings();\r\n    }\r\n\r\n    private initializeDefaultMappings(): void {\r\n        this.agentToolMappings.set(\"email\", [\r\n            \"semantic_search\",\r\n            \"generate_embedding\",\r\n            \"find_similar_highlights\",\r\n        ]);\r\n        this.agentToolMappings.set(\"research\", [\r\n            \"semantic_search\",\r\n            \"generate_embedding\",\r\n        ]);\r\n        this.agentToolMappings.set(\"notes\", [\r\n            \"semantic_search\",\r\n            \"generate_embedding\",\r\n            \"find_similar_highlights\",\r\n        ]);\r\n        this.agentToolMappings.set(\"document\", [\r\n            \"semantic_search\",\r\n            \"generate_embedding\",\r\n            \"find_similar_highlights\",\r\n        ]);\r\n        this.agentToolMappings.set(\"orchestrator\", []);\r\n    }\r\n\r\n    static getInstance(): MCPRegistry {\r\n        if (!MCPRegistry.instance) {\r\n            MCPRegistry.instance = new MCPRegistry();\r\n        }\r\n        return MCPRegistry.instance;\r\n    }\r\n\r\n    static resetInstance(): void {\r\n        MCPRegistry.instance = undefined as unknown as MCPRegistry;\r\n    }\r\n\r\n    registerServer(server: MCPServerWrapper): void {\r\n        if (this.servers.has(server.name)) {\r\n            throw new Error(`Server \"${server.name}\" already registered`);\r\n        }\r\n        this.servers.set(server.name, { wrapper: server, isRemote: false });\r\n    }\r\n\r\n    async registerRemoteServer(name: string, config: TransportConfig): Promise<void> {\r\n        if (this.servers.has(name)) {\r\n            throw new Error(`Server \"${name}\" already registered`);\r\n        }\r\n\r\n        const client = new MCPClient(name, config);\r\n        await client.connect();\r\n        this.servers.set(name, { client, isRemote: true });\r\n    }\r\n\r\n    unregisterServer(name: string): void {\r\n        const server = this.servers.get(name);\r\n        if (server?.client) {\r\n            server.client.disconnect().catch(console.error);\r\n        }\r\n        this.servers.delete(name);\r\n    }\r\n\r\n    setAgentToolMapping(agentType: AgentType, toolNames: string[]): void {\r\n        this.agentToolMappings.set(agentType, toolNames);\r\n    }\r\n\r\n    addToolToAgent(agentType: AgentType, toolName: string): void {\r\n        const existing = this.agentToolMappings.get(agentType) ?? [];\r\n        if (!existing.includes(toolName)) {\r\n            this.agentToolMappings.set(agentType, [...existing, toolName]);\r\n        }\r\n    }\r\n\r\n    getToolsForAgent(agentType: AgentType): MCPTool[] {\r\n        const allowedToolNames = this.agentToolMappings.get(agentType) ?? [];\r\n        const tools: MCPTool[] = [];\r\n\r\n        for (const [, server] of this.servers) {\r\n            const serverTools = server.wrapper?.getTools() ?? [];\r\n            for (const tool of serverTools) {\r\n                if (allowedToolNames.includes(tool.name)) {\r\n                    tools.push(tool);\r\n                }\r\n            }\r\n        }\r\n\r\n        return tools;\r\n    }\r\n\r\n    getAllTools(): MCPTool[] {\r\n        const tools: MCPTool[] = [];\r\n\r\n        for (const [, server] of this.servers) {\r\n            if (server.wrapper) {\r\n                tools.push(...server.wrapper.getTools());\r\n            }\r\n        }\r\n\r\n        return tools;\r\n    }\r\n\r\n    async callTool(name: string, args: Record<string, unknown>): Promise<unknown> {\r\n        for (const [, server] of this.servers) {\r\n            if (server.wrapper?.hasTool(name)) {\r\n                return server.wrapper.callTool(name, args);\r\n            }\r\n            if (server.client) {\r\n                const tools = await server.client.listTools();\r\n                if (tools.some((t) => t.name === name)) {\r\n                    return server.client.callTool(name, args);\r\n                }\r\n            }\r\n        }\r\n\r\n        throw new Error(`Tool not found: ${name}`);\r\n    }\r\n\r\n    getServer(name: string): RegisteredServer | undefined {\r\n        return this.servers.get(name);\r\n    }\r\n\r\n    getServerNames(): string[] {\r\n        return Array.from(this.servers.keys());\r\n    }\r\n\r\n    hasServer(name: string): boolean {\r\n        return this.servers.has(name);\r\n    }\r\n\r\n    get serverCount(): number {\r\n        return this.servers.size;\r\n    }\r\n}\r\n\r\nexport function getMCPRegistry(): MCPRegistry {\r\n    return MCPRegistry.getInstance();\r\n}\r\n"]}