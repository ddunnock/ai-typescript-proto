{"version":3,"sources":["../src/servers/search.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import { MCPServerWrapper } from \"../server\";\r\nimport { getConfig, MCPError } from \"@repo/shared\";\r\n\r\n/**\r\n * Search MCP Server - Integrates with ML service for semantic search\r\n */\r\nexport function createSearchMCPServer(): MCPServerWrapper {\r\n    const server = new MCPServerWrapper(\"search\", \"1.0.0\");\r\n    const config = getConfig();\r\n\r\n    server.registerTool(\r\n        \"semantic_search\",\r\n        \"Search for semantically similar content using embeddings\",\r\n        {\r\n            type: \"object\",\r\n            properties: {\r\n                query: { type: \"string\", description: \"Search query text\" },\r\n                limit: { type: \"number\", description: \"Maximum results (default: 10)\" },\r\n                threshold: { type: \"number\", description: \"Similarity threshold 0-1 (default: 0.7)\" },\r\n            },\r\n            required: [\"query\"],\r\n        },\r\n        async (args) => {\r\n            const { query, limit = 10, threshold = 0.7 } = args as {\r\n                query: string;\r\n                limit?: number;\r\n                threshold?: number;\r\n            };\r\n\r\n            try {\r\n                const response = await fetch(`${config.mlServiceUrl}/api/ml/embeddings/search`, {\r\n                    method: \"POST\",\r\n                    headers: { \"Content-Type\": \"application/json\" },\r\n                    body: JSON.stringify({ query, limit, threshold }),\r\n                });\r\n\r\n                if (!response.ok) {\r\n                    throw new MCPError(\r\n                        `ML service search failed: ${response.statusText}`,\r\n                        \"search\"\r\n                    );\r\n                }\r\n\r\n                const data = await response.json();\r\n                return { content: [{ type: \"text\", text: JSON.stringify(data, null, 2) }] };\r\n            } catch (error) {\r\n                throw new MCPError(\r\n                    `Semantic search failed: ${(error as Error).message}`,\r\n                    \"search\"\r\n                );\r\n            }\r\n        }\r\n    );\r\n\r\n    server.registerTool(\r\n        \"generate_embedding\",\r\n        \"Generate an embedding vector for text\",\r\n        {\r\n            type: \"object\",\r\n            properties: {\r\n                text: { type: \"string\", description: \"Text to embed\" },\r\n                document_id: { type: \"string\", description: \"Optional document ID for storage\" },\r\n            },\r\n            required: [\"text\"],\r\n        },\r\n        async (args) => {\r\n            const { text, document_id } = args as { text: string; document_id?: string };\r\n\r\n            try {\r\n                const response = await fetch(`${config.mlServiceUrl}/api/ml/embeddings`, {\r\n                    method: \"POST\",\r\n                    headers: { \"Content-Type\": \"application/json\" },\r\n                    body: JSON.stringify({ text, document_id }),\r\n                });\r\n\r\n                if (!response.ok) {\r\n                    throw new MCPError(\r\n                        `ML service embedding failed: ${response.statusText}`,\r\n                        \"search\"\r\n                    );\r\n                }\r\n\r\n                const data = await response.json();\r\n                return { content: [{ type: \"text\", text: JSON.stringify(data, null, 2) }] };\r\n            } catch (error) {\r\n                throw new MCPError(\r\n                    `Embedding generation failed: ${(error as Error).message}`,\r\n                    \"search\"\r\n                );\r\n            }\r\n        }\r\n    );\r\n\r\n    server.registerTool(\r\n        \"find_similar_highlights\",\r\n        \"Find content similar to a highlighted text selection\",\r\n        {\r\n            type: \"object\",\r\n            properties: {\r\n                highlight_text: { type: \"string\", description: \"The highlighted text\" },\r\n                context: { type: \"string\", description: \"Surrounding context\" },\r\n                source_document_id: { type: \"string\", description: \"Source document ID\" },\r\n                limit: { type: \"number\", description: \"Maximum results\" },\r\n            },\r\n            required: [\"highlight_text\"],\r\n        },\r\n        async (args) => {\r\n            const { highlight_text, context, source_document_id, limit = 5 } = args as {\r\n                highlight_text: string;\r\n                context?: string;\r\n                source_document_id?: string;\r\n                limit?: number;\r\n            };\r\n\r\n            try {\r\n                const response = await fetch(`${config.mlServiceUrl}/api/ml/highlights/similar`, {\r\n                    method: \"POST\",\r\n                    headers: { \"Content-Type\": \"application/json\" },\r\n                    body: JSON.stringify({\r\n                        highlight_text,\r\n                        context,\r\n                        source_document_id,\r\n                        limit,\r\n                    }),\r\n                });\r\n\r\n                if (!response.ok) {\r\n                    throw new MCPError(\r\n                        `ML service highlights failed: ${response.statusText}`,\r\n                        \"search\"\r\n                    );\r\n                }\r\n\r\n                const data = await response.json();\r\n                return { content: [{ type: \"text\", text: JSON.stringify(data, null, 2) }] };\r\n            } catch (error) {\r\n                throw new MCPError(\r\n                    `Find similar highlights failed: ${(error as Error).message}`,\r\n                    \"search\"\r\n                );\r\n            }\r\n        }\r\n    );\r\n\r\n    return server;\r\n}"]}