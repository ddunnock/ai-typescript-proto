{"version":3,"sources":["../src/exporters.ts"],"names":[],"mappings":";AAKO,IAAM,kBAAN,MAA+C;AAAA,EAC1C,MAAA;AAAA,EAER,WAAA,CAAY,SAAiB,SAAA,EAAW;AACpC,IAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AAAA,EAClB;AAAA,EAEA,MAAM,OAAO,KAAA,EAAmC;AAC5C,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACtB,MAAA,MAAM,WAAW,IAAA,CAAK,QAAA,GAAW,CAAA,EAAG,IAAA,CAAK,QAAQ,CAAA,EAAA,CAAA,GAAO,SAAA;AACxD,MAAA,MAAM,MAAA,GAAS,KAAK,MAAA,KAAW,OAAA,GAAU,WAAM,IAAA,CAAK,MAAA,KAAW,YAAY,QAAA,GAAM,QAAA;AAEjF,MAAA,OAAA,CAAQ,GAAA;AAAA,QACJ,CAAA,EAAG,IAAA,CAAK,MAAM,CAAA,CAAA,EAAI,MAAM,CAAA,CAAA,EAAI,IAAA,CAAK,IAAI,CAAA,EAAA,EAAK,IAAA,CAAK,IAAI,CAAA,IAAA,EAAO,QAAQ,CAAA,CAAA;AAAA,QAClE,IAAA,CAAK;AAAA,OACT;AAEA,MAAA,IAAI,IAAA,CAAK,MAAA,CAAO,MAAA,GAAS,CAAA,EAAG;AACxB,QAAA,KAAA,MAAW,KAAA,IAAS,KAAK,MAAA,EAAQ;AAC7B,UAAA,OAAA,CAAQ,IAAI,CAAA,eAAA,EAAQ,KAAA,CAAM,IAAI,CAAA,CAAA,EAAI,MAAM,UAAU,CAAA;AAAA,QACtD;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAAA,EAEA,MAAM,QAAA,GAA0B;AAAA,EAEhC;AACJ;AAKO,IAAM,iBAAN,MAA8C;AAAA,EACzC,QAAqB,EAAC;AAAA,EACtB,QAAA;AAAA,EAER,WAAA,CAAY,WAAmB,GAAA,EAAM;AACjC,IAAA,IAAA,CAAK,QAAA,GAAW,QAAA;AAAA,EACpB;AAAA,EAEA,MAAM,OAAO,KAAA,EAAmC;AAC5C,IAAA,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,GAAG,KAAK,CAAA;AAGxB,IAAA,IAAI,IAAA,CAAK,KAAA,CAAM,MAAA,GAAS,IAAA,CAAK,QAAA,EAAU;AACnC,MAAA,IAAA,CAAK,QAAQ,IAAA,CAAK,KAAA,CAAM,KAAA,CAAM,CAAC,KAAK,QAAQ,CAAA;AAAA,IAChD;AAAA,EACJ;AAAA,EAEA,QAAA,GAAwB;AACpB,IAAA,OAAO,CAAC,GAAG,IAAA,CAAK,KAAK,CAAA;AAAA,EACzB;AAAA,EAEA,kBAAkB,OAAA,EAA8B;AAC5C,IAAA,OAAO,KAAK,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,YAAY,OAAO,CAAA;AAAA,EACzD;AAAA,EAEA,eAAe,IAAA,EAA2B;AACtC,IAAA,OAAO,KAAK,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,SAAS,IAAI,CAAA;AAAA,EACnD;AAAA,EAEA,KAAA,GAAc;AACV,IAAA,IAAA,CAAK,QAAQ,EAAC;AAAA,EAClB;AAAA,EAEA,MAAM,QAAA,GAA0B;AAC5B,IAAA,IAAA,CAAK,KAAA,EAAM;AAAA,EACf;AACJ;AAKO,IAAM,oBAAN,MAAiD;AAAA,EAC5C,GAAA;AAAA,EACA,EAAA,GAAuB,IAAA;AAAA,EACvB,SAAsB,EAAC;AAAA,EACvB,aAAA;AAAA,EACA,iBAAA,GAA4B,CAAA;AAAA,EAC5B,oBAAA,GAA+B,CAAA;AAAA,EAC/B,cAAA,GAAyB,GAAA;AAAA,EAEjC,WAAA,CAAY,GAAA,EAAa,aAAA,GAAwB,GAAA,EAAK;AAClD,IAAA,IAAA,CAAK,GAAA,GAAM,GAAA;AACX,IAAA,IAAA,CAAK,aAAA,GAAgB,aAAA;AAAA,EACzB;AAAA,EAEA,MAAM,OAAA,GAAyB;AAC3B,IAAA,OAAO,IAAI,OAAA,CAAQ,CAAC,OAAA,EAAS,MAAA,KAAW;AACpC,MAAA,IAAI;AACA,QAAA,IAAA,CAAK,EAAA,GAAK,IAAI,SAAA,CAAU,IAAA,CAAK,GAAG,CAAA;AAEhC,QAAA,IAAA,CAAK,EAAA,CAAG,SAAS,MAAM;AACnB,UAAA,IAAA,CAAK,iBAAA,GAAoB,CAAA;AACzB,UAAA,IAAA,CAAK,WAAA,EAAY;AACjB,UAAA,OAAA,EAAQ;AAAA,QACZ,CAAA;AAEA,QAAA,IAAA,CAAK,EAAA,CAAG,OAAA,GAAU,CAAC,KAAA,KAAU;AACzB,UAAA,OAAA,CAAQ,KAAA,CAAM,oBAAoB,KAAK,CAAA;AACvC,UAAA,MAAA,CAAO,KAAK,CAAA;AAAA,QAChB,CAAA;AAEA,QAAA,IAAA,CAAK,EAAA,CAAG,UAAU,MAAM;AACpB,UAAA,IAAA,CAAK,gBAAA,EAAiB;AAAA,QAC1B,CAAA;AAAA,MACJ,SAAS,KAAA,EAAO;AACZ,QAAA,MAAA,CAAO,KAAK,CAAA;AAAA,MAChB;AAAA,IACJ,CAAC,CAAA;AAAA,EACL;AAAA,EAEQ,gBAAA,GAAyB;AAC7B,IAAA,IAAI,IAAA,CAAK,iBAAA,IAAqB,IAAA,CAAK,oBAAA,EAAsB;AACrD,MAAA,OAAA,CAAQ,MAAM,gCAAgC,CAAA;AAC9C,MAAA;AAAA,IACJ;AAEA,IAAA,IAAA,CAAK,iBAAA,EAAA;AACL,IAAA,UAAA,CAAW,MAAM;AACb,MAAA,IAAA,CAAK,OAAA,EAAQ,CAAE,KAAA,CAAM,OAAA,CAAQ,KAAK,CAAA;AAAA,IACtC,CAAA,EAAG,IAAA,CAAK,cAAA,GAAiB,IAAA,CAAK,iBAAiB,CAAA;AAAA,EACnD;AAAA,EAEQ,WAAA,GAAoB;AACxB,IAAA,IAAI,CAAC,IAAA,CAAK,EAAA,IAAM,KAAK,EAAA,CAAG,UAAA,KAAe,UAAU,IAAA,EAAM;AAEvD,IAAA,OAAO,IAAA,CAAK,MAAA,CAAO,MAAA,GAAS,CAAA,EAAG;AAC3B,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,MAAA,CAAO,KAAA,EAAM;AAC/B,MAAA,IAAI,IAAA,EAAM;AACN,QAAA,IAAA,CAAK,EAAA,CAAG,IAAA,CAAK,IAAA,CAAK,SAAA,CAAU,EAAE,MAAM,MAAA,EAAQ,IAAA,EAAM,IAAA,EAAM,CAAC,CAAA;AAAA,MAC7D;AAAA,IACJ;AAAA,EACJ;AAAA,EAEA,MAAM,OAAO,KAAA,EAAmC;AAC5C,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACtB,MAAA,IAAI,IAAA,CAAK,EAAA,EAAI,UAAA,KAAe,SAAA,CAAU,IAAA,EAAM;AACxC,QAAA,IAAA,CAAK,EAAA,CAAG,IAAA,CAAK,IAAA,CAAK,SAAA,CAAU,EAAE,MAAM,MAAA,EAAQ,IAAA,EAAM,IAAA,EAAM,CAAC,CAAA;AAAA,MAC7D,CAAA,MAAO;AACH,QAAA,IAAA,CAAK,MAAA,CAAO,KAAK,IAAI,CAAA;AACrB,QAAA,IAAI,IAAA,CAAK,MAAA,CAAO,MAAA,GAAS,IAAA,CAAK,aAAA,EAAe;AACzC,UAAA,IAAA,CAAK,OAAO,KAAA,EAAM;AAAA,QACtB;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAAA,EAEA,MAAM,QAAA,GAA0B;AAC5B,IAAA,IAAI,KAAK,EAAA,EAAI;AACT,MAAA,IAAA,CAAK,GAAG,KAAA,EAAM;AACd,MAAA,IAAA,CAAK,EAAA,GAAK,IAAA;AAAA,IACd;AACA,IAAA,IAAA,CAAK,SAAS,EAAC;AAAA,EACnB;AACJ;AAKO,IAAM,mBAAN,MAAgD;AAAA,EAC3C,QAAA;AAAA,EAER,YAAY,QAAA,EAAwD;AAChE,IAAA,IAAA,CAAK,QAAA,GAAW,QAAA;AAAA,EACpB;AAAA,EAEA,MAAM,OAAO,KAAA,EAAmC;AAC5C,IAAA,MAAM,IAAA,CAAK,SAAS,KAAK,CAAA;AAAA,EAC7B;AAAA,EAEA,MAAM,QAAA,GAA0B;AAAA,EAEhC;AACJ","file":"chunk-VQ67DVYZ.js","sourcesContent":["import type { TraceSpan, TraceExporter } from \"./types\";\r\n\r\n/**\r\n * Console exporter - logs spans to console (for development)\r\n */\r\nexport class ConsoleExporter implements TraceExporter {\r\n    private prefix: string;\r\n\r\n    constructor(prefix: string = \"[TRACE]\") {\r\n        this.prefix = prefix;\r\n    }\r\n\r\n    async export(spans: TraceSpan[]): Promise<void> {\r\n        for (const span of spans) {\r\n            const duration = span.duration ? `${span.duration}ms` : \"running\";\r\n            const status = span.status === \"error\" ? \"❌\" : span.status === \"success\" ? \"✅\" : \"⏳\";\r\n\r\n            console.log(\r\n                `${this.prefix} ${status} ${span.name} [${span.kind}] - ${duration}`,\r\n                span.attributes\r\n            );\r\n\r\n            if (span.events.length > 0) {\r\n                for (const event of span.events) {\r\n                    console.log(`  └─ ${event.name}`, event.attributes);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    async shutdown(): Promise<void> {\r\n        // Nothing to clean up\r\n    }\r\n}\r\n\r\n/**\r\n * Memory exporter - stores spans in memory (for testing/dev console)\r\n */\r\nexport class MemoryExporter implements TraceExporter {\r\n    private spans: TraceSpan[] = [];\r\n    private maxSpans: number;\r\n\r\n    constructor(maxSpans: number = 1000) {\r\n        this.maxSpans = maxSpans;\r\n    }\r\n\r\n    async export(spans: TraceSpan[]): Promise<void> {\r\n        this.spans.push(...spans);\r\n\r\n        // Trim if over limit\r\n        if (this.spans.length > this.maxSpans) {\r\n            this.spans = this.spans.slice(-this.maxSpans);\r\n        }\r\n    }\r\n\r\n    getSpans(): TraceSpan[] {\r\n        return [...this.spans];\r\n    }\r\n\r\n    getSpansByTraceId(traceId: string): TraceSpan[] {\r\n        return this.spans.filter((s) => s.traceId === traceId);\r\n    }\r\n\r\n    getSpansByKind(kind: string): TraceSpan[] {\r\n        return this.spans.filter((s) => s.kind === kind);\r\n    }\r\n\r\n    clear(): void {\r\n        this.spans = [];\r\n    }\r\n\r\n    async shutdown(): Promise<void> {\r\n        this.clear();\r\n    }\r\n}\r\n\r\n/**\r\n * WebSocket exporter - sends spans to dev console in real-time\r\n */\r\nexport class WebSocketExporter implements TraceExporter {\r\n    private url: string;\r\n    private ws: WebSocket | null = null;\r\n    private buffer: TraceSpan[] = [];\r\n    private maxBufferSize: number;\r\n    private reconnectAttempts: number = 0;\r\n    private maxReconnectAttempts: number = 5;\r\n    private reconnectDelay: number = 1000;\r\n\r\n    constructor(url: string, maxBufferSize: number = 100) {\r\n        this.url = url;\r\n        this.maxBufferSize = maxBufferSize;\r\n    }\r\n\r\n    async connect(): Promise<void> {\r\n        return new Promise((resolve, reject) => {\r\n            try {\r\n                this.ws = new WebSocket(this.url);\r\n\r\n                this.ws.onopen = () => {\r\n                    this.reconnectAttempts = 0;\r\n                    this.flushBuffer();\r\n                    resolve();\r\n                };\r\n\r\n                this.ws.onerror = (error) => {\r\n                    console.error(\"WebSocket error:\", error);\r\n                    reject(error);\r\n                };\r\n\r\n                this.ws.onclose = () => {\r\n                    this.attemptReconnect();\r\n                };\r\n            } catch (error) {\r\n                reject(error);\r\n            }\r\n        });\r\n    }\r\n\r\n    private attemptReconnect(): void {\r\n        if (this.reconnectAttempts >= this.maxReconnectAttempts) {\r\n            console.error(\"Max reconnect attempts reached\");\r\n            return;\r\n        }\r\n\r\n        this.reconnectAttempts++;\r\n        setTimeout(() => {\r\n            this.connect().catch(console.error);\r\n        }, this.reconnectDelay * this.reconnectAttempts);\r\n    }\r\n\r\n    private flushBuffer(): void {\r\n        if (!this.ws || this.ws.readyState !== WebSocket.OPEN) return;\r\n\r\n        while (this.buffer.length > 0) {\r\n            const span = this.buffer.shift();\r\n            if (span) {\r\n                this.ws.send(JSON.stringify({ type: \"span\", data: span }));\r\n            }\r\n        }\r\n    }\r\n\r\n    async export(spans: TraceSpan[]): Promise<void> {\r\n        for (const span of spans) {\r\n            if (this.ws?.readyState === WebSocket.OPEN) {\r\n                this.ws.send(JSON.stringify({ type: \"span\", data: span }));\r\n            } else {\r\n                this.buffer.push(span);\r\n                if (this.buffer.length > this.maxBufferSize) {\r\n                    this.buffer.shift();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    async shutdown(): Promise<void> {\r\n        if (this.ws) {\r\n            this.ws.close();\r\n            this.ws = null;\r\n        }\r\n        this.buffer = [];\r\n    }\r\n}\r\n\r\n/**\r\n * Callback exporter - calls a function with spans (for custom handling)\r\n */\r\nexport class CallbackExporter implements TraceExporter {\r\n    private callback: (spans: TraceSpan[]) => void | Promise<void>;\r\n\r\n    constructor(callback: (spans: TraceSpan[]) => void | Promise<void>) {\r\n        this.callback = callback;\r\n    }\r\n\r\n    async export(spans: TraceSpan[]): Promise<void> {\r\n        await this.callback(spans);\r\n    }\r\n\r\n    async shutdown(): Promise<void> {\r\n        // Nothing to clean up\r\n    }\r\n}\r\n"]}