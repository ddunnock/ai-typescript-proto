{"version":3,"sources":["../src/tracer.ts"],"names":[],"mappings":"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","file":"chunk-PXGEZHTQ.js","sourcesContent":["import { generateId } from \"@repo/shared\";\r\nimport type {\r\n    TraceSpan,\r\n    Trace,\r\n    SpanKind,\r\n    SpanStatus,\r\n    SpanOptions,\r\n    SpanEvent,\r\n    TracerConfig,\r\n    TraceExporter,\r\n} from \"./types\";\r\n\r\nexport class AgentTracer {\r\n    private serviceName: string;\r\n    private enabled: boolean;\r\n    private activeSpans: Map<string, TraceSpan> = new Map();\r\n    private activeTraces: Map<string, Trace> = new Map();\r\n    private completedTraces: Trace[] = [];\r\n    private exporters: TraceExporter[] = [];\r\n    private spanStack: string[] = [];\r\n\r\n    constructor(config: TracerConfig) {\r\n        this.serviceName = config.serviceName;\r\n        this.enabled = config.enabled ?? true;\r\n    }\r\n\r\n    addExporter(exporter: TraceExporter): void {\r\n        this.exporters.push(exporter);\r\n    }\r\n\r\n    startTrace(name: string, metadata?: Record<string, unknown>): string {\r\n        if (!this.enabled) return \"\";\r\n\r\n        const traceId = generateId(\"trace\");\r\n        const trace: Trace = {\r\n            id: traceId,\r\n            name,\r\n            startTime: Date.now(),\r\n            status: \"running\",\r\n            spans: [],\r\n            metadata,\r\n        };\r\n\r\n        this.activeTraces.set(traceId, trace);\r\n        return traceId;\r\n    }\r\n\r\n    endTrace(traceId: string, status?: SpanStatus): Trace | undefined {\r\n        if (!this.enabled) return undefined;\r\n\r\n        const trace = this.activeTraces.get(traceId);\r\n        if (!trace) return undefined;\r\n\r\n        trace.endTime = Date.now();\r\n        trace.duration = trace.endTime - trace.startTime;\r\n        trace.status = status ?? \"success\";\r\n\r\n        this.activeTraces.delete(traceId);\r\n        this.completedTraces.push(trace);\r\n\r\n        // Export completed trace spans\r\n        this.exportSpans(trace.spans).catch(console.error);\r\n\r\n        return trace;\r\n    }\r\n\r\n    startSpan(\r\n        name: string,\r\n        traceId: string,\r\n        options?: SpanOptions\r\n    ): string {\r\n        if (!this.enabled) return \"\";\r\n\r\n        const spanId = generateId(\"span\");\r\n        const parentSpanId = options?.parentSpanId ?? this.spanStack[this.spanStack.length - 1];\r\n\r\n        const span: TraceSpan = {\r\n            id: spanId,\r\n            traceId,\r\n            parentSpanId,\r\n            name,\r\n            kind: options?.kind ?? \"agent\",\r\n            status: \"running\",\r\n            startTime: Date.now(),\r\n            attributes: {\r\n                \"service.name\": this.serviceName,\r\n                ...options?.attributes,\r\n            },\r\n            events: [],\r\n        };\r\n\r\n        this.activeSpans.set(spanId, span);\r\n        this.spanStack.push(spanId);\r\n\r\n        // Add to trace\r\n        const trace = this.activeTraces.get(traceId);\r\n        if (trace) {\r\n            trace.spans.push(span);\r\n            if (!trace.rootSpan) {\r\n                trace.rootSpan = span;\r\n            }\r\n        }\r\n\r\n        return spanId;\r\n    }\r\n\r\n    endSpan(spanId: string, status?: SpanStatus, error?: Error): TraceSpan | undefined {\r\n        if (!this.enabled) return undefined;\r\n\r\n        const span = this.activeSpans.get(spanId);\r\n        if (!span) return undefined;\r\n\r\n        span.endTime = Date.now();\r\n        span.duration = span.endTime - span.startTime;\r\n        span.status = error ? \"error\" : (status ?? \"success\");\r\n\r\n        if (error) {\r\n            span.attributes[\"error.message\"] = error.message;\r\n            span.attributes[\"error.stack\"] = error.stack;\r\n            this.addSpanEvent(spanId, \"exception\", {\r\n                \"exception.message\": error.message,\r\n                \"exception.type\": error.name,\r\n            });\r\n        }\r\n\r\n        this.activeSpans.delete(spanId);\r\n\r\n        // Remove from stack\r\n        const stackIndex = this.spanStack.indexOf(spanId);\r\n        if (stackIndex !== -1) {\r\n            this.spanStack.splice(stackIndex, 1);\r\n        }\r\n\r\n        return span;\r\n    }\r\n\r\n    addSpanEvent(spanId: string, name: string, attributes?: Record<string, unknown>): void {\r\n        if (!this.enabled) return;\r\n\r\n        const span = this.activeSpans.get(spanId);\r\n        if (!span) return;\r\n\r\n        const event: SpanEvent = {\r\n            name,\r\n            timestamp: Date.now(),\r\n            attributes,\r\n        };\r\n\r\n        span.events.push(event);\r\n    }\r\n\r\n    setSpanAttribute(spanId: string, key: string, value: unknown): void {\r\n        if (!this.enabled) return;\r\n\r\n        const span = this.activeSpans.get(spanId);\r\n        if (span) {\r\n            span.attributes[key] = value;\r\n        }\r\n    }\r\n\r\n    setSpanAttributes(spanId: string, attributes: Record<string, unknown>): void {\r\n        if (!this.enabled) return;\r\n\r\n        const span = this.activeSpans.get(spanId);\r\n        if (span) {\r\n            Object.assign(span.attributes, attributes);\r\n        }\r\n    }\r\n\r\n    // Convenience methods for specific span types\r\n\r\n    startAgentSpan(\r\n        agentName: string,\r\n        agentType: string,\r\n        traceId: string,\r\n        parentSpanId?: string\r\n    ): string {\r\n        return this.startSpan(`agent.${agentName}`, traceId, {\r\n            kind: \"agent\",\r\n            parentSpanId,\r\n            attributes: {\r\n                \"agent.name\": agentName,\r\n                \"agent.type\": agentType,\r\n            },\r\n        });\r\n    }\r\n\r\n    startLLMSpan(\r\n        provider: string,\r\n        model: string,\r\n        operation: \"generate\" | \"stream\" | \"generateWithTools\",\r\n        traceId: string,\r\n        parentSpanId?: string\r\n    ): string {\r\n        return this.startSpan(`llm.${operation}`, traceId, {\r\n            kind: \"llm\",\r\n            parentSpanId,\r\n            attributes: {\r\n                \"llm.provider\": provider,\r\n                \"llm.model\": model,\r\n                \"llm.operation\": operation,\r\n            },\r\n        });\r\n    }\r\n\r\n    startToolSpan(\r\n        toolName: string,\r\n        args: Record<string, unknown>,\r\n        traceId: string,\r\n        parentSpanId?: string\r\n    ): string {\r\n        return this.startSpan(`tool.${toolName}`, traceId, {\r\n            kind: \"tool\",\r\n            parentSpanId,\r\n            attributes: {\r\n                \"tool.name\": toolName,\r\n                \"tool.args\": JSON.stringify(args),\r\n            },\r\n        });\r\n    }\r\n\r\n    startMCPSpan(\r\n        serverName: string,\r\n        operation: string,\r\n        traceId: string,\r\n        parentSpanId?: string\r\n    ): string {\r\n        return this.startSpan(`mcp.${serverName}.${operation}`, traceId, {\r\n            kind: \"mcp\",\r\n            parentSpanId,\r\n            attributes: {\r\n                \"mcp.server\": serverName,\r\n                \"mcp.operation\": operation,\r\n            },\r\n        });\r\n    }\r\n\r\n    // Utility methods\r\n\r\n    getActiveSpan(spanId: string): TraceSpan | undefined {\r\n        return this.activeSpans.get(spanId);\r\n    }\r\n\r\n    getActiveTrace(traceId: string): Trace | undefined {\r\n        return this.activeTraces.get(traceId);\r\n    }\r\n\r\n    getCompletedTraces(): Trace[] {\r\n        return [...this.completedTraces];\r\n    }\r\n\r\n    getCurrentSpanId(): string | undefined {\r\n        return this.spanStack[this.spanStack.length - 1];\r\n    }\r\n\r\n    clearCompletedTraces(): void {\r\n        this.completedTraces = [];\r\n    }\r\n\r\n    private async exportSpans(spans: TraceSpan[]): Promise<void> {\r\n        if (spans.length === 0) return;\r\n\r\n        await Promise.all(\r\n            this.exporters.map((exporter) =>\r\n                exporter.export(spans).catch((err) => {\r\n                    console.error(\"Failed to export spans:\", err);\r\n                })\r\n            )\r\n        );\r\n    }\r\n\r\n    async shutdown(): Promise<void> {\r\n        // End all active spans\r\n        for (const spanId of this.activeSpans.keys()) {\r\n            this.endSpan(spanId, \"error\", new Error(\"Tracer shutdown\"));\r\n        }\r\n\r\n        // End all active traces\r\n        for (const traceId of this.activeTraces.keys()) {\r\n            this.endTrace(traceId, \"error\");\r\n        }\r\n\r\n        // Shutdown exporters\r\n        await Promise.all(\r\n            this.exporters.map((exporter) => exporter.shutdown())\r\n        );\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nlet globalTracer: AgentTracer | null = null;\r\n\r\nexport function initTracer(config: TracerConfig): AgentTracer {\r\n    globalTracer = new AgentTracer(config);\r\n    return globalTracer;\r\n}\r\n\r\nexport function getTracer(): AgentTracer {\r\n    if (!globalTracer) {\r\n        globalTracer = new AgentTracer({\r\n            serviceName: \"convergence-agents\",\r\n            enabled: true,\r\n        });\r\n    }\r\n    return globalTracer;\r\n}\r\n\r\nexport function resetTracer(): void {\r\n    globalTracer = null;\r\n}\r\n"]}